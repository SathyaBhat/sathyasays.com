---
title: Self-hosting your location history with OwnTracks 
author: Sathyajith Bhat
type: post
date: 2024-07-13
url: /2024/07/13/self-hosting-owntracks-google-maps-timeline
summary: Looking to find an alternative to Google Maps Timeline? OwnTracks is a nice self-hoted location history tracker.
categories:
  - Self-Hosting
tags:
  - owntracks
  - google maps
---

_Thumbnail image generated by [Stable Diffusion Online](https://stablediffusionweb.com/) with the prompt: applying name tags to a server in a data center._

### Why OwnTracks?

OwnTracks is a private location diary. Think of it as a self-hosted version of Google Maps Timeline. If you're not familiar with Google Maps Timeline, it's a service that tracks your location history and shows your previous routes and places that you've been on based on your location history. I've been using Google Maps Timeline for a really long time and have been quite happy with it. 

Recently, Google [announced that they are changing](https://support.google.com/maps/answer/14169818?visit_id=638564387215552617-1652775936&p=maps_odlh&rd=1) the way location history is saved - they will no longer keep the location history tied to your Google Account and the history will be local to the device. Google will delete all the location history on the account. Since the history is local the device, a side effect is the Timeline web view is also going away. 

I use the Google Maps Timeline web app quite heavily and was disappointed to know it was going away. When looking for alternatives to Timeline, Rushabh told me about OwnTracks. Since I had upgraded the memory on [my NAS](https://sathyabh.at/nas), I have some extra breathing space and decided to try it out. With my upcoming Seattle trip, I thought this was a great way to test out OwnTracks and see how it compares to Google Maps Timeline.

### What is OwnTracks?

OwnTracks lets your build your own private location diary. OwnTracks comes with a serverside component to save history and client (mobile) applications that report your location. The client applications report location when the smartphone OS has reported to OwnTracks that is has moved enough. Keep this in mind - OwnTracks doesn't actively poll the current location (at least not on iOS anyway), but rather waits for the mobile OS to report a change in location. You can more details about how the mobile app works on their [documentation booklet](https://owntracks.org/booklet/features/location/). 

On the server side, OwnTracks has a component called the recorder that stores the location data. The applications talk to the recorder via a MQTT or HTTP POST call and stores the data in plaintext files. The recorder primarily uses mqtt as it's protocol, but OwnTracks have implemented a HTTP server that clients can talk to. The OwnTracks architecture looks like below

![owntracks architecture](https://i.sathyabh.at/sb/owntracks/owntracks-arch.png)


### Setting up OwnTracks using Docker

OwnTracks has a nice repo called quicksetup that helps you get started. However, the quicksetup is targetted at setting up a new VPS to run OwnThings recorder, a mosquitto mqtt broker, nginx as the reverse proxy, and wasn't suitable for running OwnTracks as con tainers using Docker. Thankfully, they do build and publish pre-built container images and have a few sample docker-compose configs in the [docker-recorder](https://github.com/owntracks/docker-recorder) repo that we can use. When I setup initially, I was using the basic web UI built into the recorder image. I found out that OwnTracks has a nice frontend SPA that has a lot more features (such us location history, heatmap etc) and thus I decided to use it as well. 

After couple of iterations, this is the docker-compose file that worked for me:

```yaml
services:
  otrecorder:
    image: owntracks/recorder
    volumes:
      - ./store:/store
    restart: unless-stopped
    environment:
      OTR_HOST: mosquitto
    networks:
      - sanctuary

  frontend:
    image: owntracks/frontend
    volumes:
      - ./frontend/config.js:/usr/share/nginx/html/config/config.js
    restart: unless-stopped
    environment:
      - SERVER_HOST=otrecorder
      - SERVER_PORT=8083
    networks:
      - sanctuary

  mosquitto:
    image: eclipse-mosquitto
    volumes:
      - ./mosquitto/data:/mosquitto/data
      - ./mosquitto/logs:/mosquitto/logs
      - ./mosquitto/conf:/mosquitto/config
    restart: unless-stopped
    networks:
      - sanctuary

networks:
  sanctuary:
    external: true
```

There are a couple of deviations I have done from the example compose config files:

* There are no ports published - that is because I use Caddy as the reverse proxy, and Caddy routes the requests to the OwnTrack containers
* OwnTracks requires that a mqtt broker be present, else it just quits. So even though I'm not using the mqtt broker endpoint, it is running. mosquitto barely consumes any resources so I'm fine with it.
* I make use of bind mounts to store the data instead of Docker Volumes. 
* `sanctuary` is the external custom Docker bridge network that is attached to all the containers that are accessible by Caddy.
* The mqtt broker doesn't have any auth configured, I am fine with this - you'll have to change this according to your needs.

In addition to the above compose file, I added the following config files:

* `mosquitto.conf` file in  `mosquitto/conf/mosquitto.conf` that configures mosquitto broker to allow anonymous access

``` conf
allow_anonymous true
listener 1883
socket_domain ipv4
```

To allow connections from the outside world, I use Caddy as my reverse proxy. My NAS doesn't allow for connections from the outside world and I use tailscale so that only those devices that are part of my tailnet can connect to the server. The Caddyfile looks like below

* Caddy config file:

```Caddyfile
(config) {

# otrecorder path is used for the recorder/OwnTracks API
  handle_path /otrecorder/* {
    reverse_proxy owntracks-otrecorder-1:8083
  }

# owntracks endpoint used by the OwnTracks frontend SPA
  handle_path /owntracks/* {
    reverse_proxy owntracks-frontend-1:80
  }
}

nas.my-tailnet.ts.net {
  import config
}
```

With these files configured, start the containers by typing

```bash
# if you have the older version of docker-compose
docker-compose up -d
```

or 

```bash
# if you have the newer version of docker-compose
docker compose up -d
```

You can check the logs and confirm that OwnTracks is running using the below commands

```bash
# if you have the older version of docker-compose
docker-compose logs -f
```
or

```bash
# if you have the newer version of docker-compose
docker compose logs -f
```

The logs should show something like below to indicate OwnTracks is running as expected

```log
mosquitto-1   | 1720854672: mosquitto version 2.0.18 starting
mosquitto-1   | 1720854672: Config loaded from /mosquitto/config/mosquitto.conf.
mosquitto-1   | 1720854672: Opening ipv4 listen socket on port 1883.
mosquitto-1   | 1720854672: mosquitto version 2.0.18 running
mosquitto-1   | 1720854672: New connection from 172.19.0.15:43446 on port 1883.
mosquitto-1   | 1720854672: New client connected from 172.19.0.15:43446 as ot-recorder-58435cc977cf-7 (p2, c0, k60).
otrecorder-1  | + version 0.9.7 starting with STORAGEDIR=/store
otrecorder-1  | + connecting to MQTT on mosquitto:1883 as clientID ot-recorder-58435cc977cf-7 without TLS
otrecorder-1  | + HTTP listener started on 0.0.0.0:8083, without browser-apikey
otrecorder-1  | + HTTP prefix is unset
otrecorder-1  | + Using storage at /store with precision 7
otrecorder-1  | + TZDATADB is at /config/timezone16.bin: R_OK
otrecorder-1  | + Subscribing to owntracks/# (qos=2)
```


With this config, my devices that have tailscale running can connect to OwnTracks using the `https://nas.my-tailnet.ts.net/otrecorder` endpoint for the OwnTracks API and `https://nas.my-tailnet.ts.net/owntracks` endpoint to load the frontend app. Despite these, the frontend SPA was still not loading correctly - the map was blank. I could see that the API was fetching the data correctly, but it was not being drawn on the map. After searching the Owntracks' frontend repo, I came across this issue which described [the problem](https://github.com/owntracks/frontend/issues/89), and thus I updated my `frontend/config.js` file as below to include the basepath

```js
window.owntracks = window.owntracks || {};
window.owntracks.config = {
  api: {
    baseUrl: 'https://nas.my-tailnet.ts.net/otrecorder/',
  },
  router: {
    basePath: '/owntracks',
  },
};
```

and voila, that got things working.  